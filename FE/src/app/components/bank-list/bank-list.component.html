@if (isLoading && !isError) {
<app-loader></app-loader>
} @else if (!isLoading && isError) {
<app-error-message-label [errorMessage]="errorMessage">
</app-error-message-label>
} @else if(!isLoading && !isError){
<section>
    @if (currentUser?.bank_accounts?.length === 0) {
    <h2 class="text-base text-gray-800 dark:text-white mb-4 mt-4">
        Nesssun conto inserito, vai in modifica per inserirne uno
    </h2>
    }
    @for (bankAccount of currentUser?.bank_accounts; track $index) {
    <div class="mb-6 relative">
        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg mb-4 border border-gray-200 dark:border-gray-700">

            @if (isEdit) {
            <button 
                (click)="removeBankAccount($index)"
                class="absolute top-3 right-3 text-gray-400 hover:text-red-600 text-lg font-bold focus:outline-none"
                aria-label="Rimuovi conto">
                ✕
            </button>
            }
            <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-2">Conto #{{$index+1}}</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <span class="block text-sm text-gray-500 dark:text-gray-400">Nome conto</span>
                    @if(!isEdit){
                    <p class="text-base font-medium text-gray-900 dark:text-white">{{bankAccount.name}}</p>
                    }
                    @else {
                    <input [(ngModel)]="bankAccount.name" placeholder="inserisci nome del conto" type="text"
                        class="w-full mt-2 appearance-none px-4 py-3 pr-10 rounded-lg text-sm border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200 ease-in-out ng-untouched ng-pristine ng-valid">
                    }
                </div>
                <div>
                    <span class="block text-sm text-gray-500 dark:text-gray-400">Tipologia</span>
                    @if (!isEdit) {
                    <p class="text-base font-medium text-gray-900 dark:text-white">{{bankAccount.type}}</p>
                    }
                    @else {
                    <select id="type" [(ngModel)]="bankAccount.type" name="type"
                        class="w-full mt-2 appearance-none px-4 py-3 pr-10 rounded-lg text-sm border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200 ease-in-out">

                        @for(option of bankAccountTypeService.getTypes(); track $index){
                        <option [value]="option">
                            {{ option }}
                        </option>
                        }
                    </select>
                    }
                </div>
                <div>
                    <span class="block text-sm text-gray-500 dark:text-gray-400">Ammontare attuale</span>
                    @if (!isEdit) {
                    <p class="text-base font-medium text-gray-900 dark:text-white">{{bankAccount.amount}}€</p>
                    }
                    @else {
                    <input [(ngModel)]="bankAccount.amount" placeholder="inserisci l'ammontare iniziale del conto"
                        type="number" min="0" class="w-full mt-2 appearance-none px-4 py-3 pr-10 rounded-lg text-sm border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200 ease-in-out ng-untouched ng-pristine ng-valid" 
                        [disabled]="!isRegister">
                    }
                </div>
            </div>
        </div>
    </div>
    }

    @if (isEdit) {
    <button (click)="addBankAccount()" [disabled]="this.currentUser?.bank_accounts?.length === 5" class="w-full px-5 py-2.5 text-sm font-medium text-white bg-blue-700 rounded-lg 
                          hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 
                          dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800 focus:outline-none
                          disabled:bg-blue-300 disabled:cursor-not-allowed dark:disabled:bg-blue-900 mb-5">
        Aggiungi Conto
    </button>
    }
</section>
}